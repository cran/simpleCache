<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Nathan Sheffield" />

<meta name="date" content="2026-02-27" />

<title>Generating caches on a cluster</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rstudio/markdown/inst/resources/prism-xcode.css" data-external="1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/yihui/knitr/inst/misc/vignette.css" data-external="1">
<script src="https://cdn.jsdelivr.net/combine/npm/@xiee/utils/js/code-lang.min.js,npm/@xiee/utils/js/number-captions.min.js,npm/prismjs@1.29.0/components/prism-core.min.js" data-external="1" defer></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" data-external="1" defer></script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>











</head>

<body>




<h1 class="title toc-ignore">Generating caches on a cluster</h1>
<h4 class="author">Nathan Sheffield</h4>
<h4 class="date">2026-02-27</h4>



<div id="generating-caches-in-parallel-using-batchtools" class="section level1">
<h1>Generating caches in parallel using batchtools</h1>
<p>By default, <code>simpleCache</code> creates caches in the R session
you use to call it. If you need to make lots of caches, or very large
caches, you may want instead to sub these as jobs to a cluster resource
manager (like SLURM). simpleCache can do this using functionality from
the <code>batchtools</code> package.</p>
<p>This vignette is unevaluated because it relies on the
<code>batchtools</code> package and a cluster environment.</p>
<p>To do this, first, create a <code>batchtools</code> registry. You can
follow more detailed documentation in the <code>batchtools</code>
package, but here’s some code to get you started:</p>
<pre class="r"><code>library(simpleCache)
setCacheDir(tempdir())

registry = batchtools::makeRegistry(NA)
templateFile = system.file(&quot;templates/slurm-advanced.tmpl&quot;, package = &quot;simpleCache&quot;)
registry$cluster.functions = batchtools::makeClusterFunctionsSlurm(
  template = templateFile)
registry</code></pre>
<p>Notice that I’m using a custom slurm template here. With a registry
in hand, we next need to define the resources this cache job will
require:</p>
<pre class="r"><code>resources = list(ncpus=1, memory=1000, walltime=60, partition=&quot;serial&quot;)</code></pre>
<p>Then, we simply add these as arguments to <code>simpleCache()</code>
like so:</p>
<pre class="r"><code>simpleCache(&quot;testBatch&quot;, {
  rnorm(1e7, 0, 1)
  }, batchRegistry=registry, batchResources=resources)</code></pre>
<p>This will now create and submit a job script to the cluster. That job
script will have R code to create your <code>testBatch</code> cache by
calling the code in your <code>simpleCache</code> call,
<code>rnorm(1e7, 0, 1)</code>. Next time you run this function, it will
just load the cache without recreating it, as you would expect
simpleCache to do. Now there’s a bunch of other stuff you can use
<code>batchtools</code> to do with these jobs:</p>
<pre class="r"><code>batchtools::getJobTable(reg=registry)
batchtools::getJobPars()
batchtools::getStatus()

batchtools::getJobTable(reg=registry)
batchtools::getJobPars(1, reg=registry)
batchtools::loadResult(1, reg=registry)
# batchtools::testJob(1, reg=registry)
# killJobs()</code></pre>
<p>When you’re done, you may want to remove your temporary registry:</p>
<pre class="r"><code>batchtools::removeRegistry(reg=registry)</code></pre>
<p>See <code>batchtools</code> documentation for more details on using
registries.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
